# Meter Sync Flow Diagram

## Complete Flow with Debugger Breakpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SYNC FRONTEND (React)                              â”‚
â”‚                    sync/frontend/src/components/                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MeterSyncCard.tsx                                                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ User clicks: "Trigger Meter Sync" button                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ handleMeterSyncTrigger() {                                          â”‚   â”‚
â”‚  â”‚   await meterSyncApi.triggerSync()                                  â”‚   â”‚
â”‚  â”‚ }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â”‚ HTTP POST                               â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ sync/frontend/src/api/services.ts                                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ meterSyncApi.triggerSync() {                                        â”‚   â”‚
â”‚  â”‚   POST /api/local/meter-sync-trigger                                â”‚   â”‚
â”‚  â”‚ }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ HTTP POST
                                    â”‚ /api/local/meter-sync-trigger
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SYNC MCP SERVER (Node.js)                              â”‚
â”‚                    sync/mcp/src/api/server.ts                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ POST /api/local/meter-sync-trigger                                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ ğŸ”´ DEBUGGER #1 BREAKS HERE                                          â”‚   â”‚
â”‚  â”‚ debugger;                                                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ âœ“ Validate meterSyncAgent exists                                    â”‚   â”‚
â”‚  â”‚ âœ“ Check if sync already in progress                                 â”‚   â”‚
â”‚  â”‚ âœ“ Call: this.meterSyncAgent.triggerSync()                           â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Return: {                                                            â”‚   â”‚
â”‚  â”‚   success: true,                                                    â”‚   â”‚
â”‚  â”‚   message: "Meter sync completed successfully",                     â”‚   â”‚
â”‚  â”‚   result: { inserted, updated, deleted, timestamp }                 â”‚   â”‚
â”‚  â”‚ }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â”‚ Calls triggerSync()                     â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MeterSyncAgent.triggerSync()                                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ async triggerSync() {                                               â”‚   â”‚
â”‚  â”‚   return this.performSync()                                         â”‚   â”‚
â”‚  â”‚ }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â”‚ Calls performSync()                     â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MeterSyncAgent.performSync()                                         â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ ğŸ”´ DEBUGGER #2 BREAKS HERE                                          â”‚   â”‚
â”‚  â”‚ debugger;                                                            â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ âœ“ Check if sync already in progress                                 â”‚   â”‚
â”‚  â”‚ âœ“ Get tenant_id from local database                                 â”‚   â”‚
â”‚  â”‚ âœ“ Call: this.getRemoteMeters(tenantId)                              â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚    â”‚ getRemoteMeters(tenantId)                                   â”‚  â”‚   â”‚
â”‚  â”‚    â”‚                                                             â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ ğŸ”´ DEBUGGER #3 BREAKS HERE                                 â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ debugger;                                                  â”‚  â”‚   â”‚
â”‚  â”‚    â”‚                                                             â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ Query REMOTE database:                                     â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ SELECT m.id, m.name, m.ip, m.port, m.active,              â”‚  â”‚   â”‚
â”‚  â”‚    â”‚        me.element                                          â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ FROM meter m                                               â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ JOIN meter_element me ON me.meter_id = m.id                â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ WHERE m.tenant_id = $1                                     â”‚  â”‚   â”‚
â”‚  â”‚    â”‚                                                             â”‚  â”‚   â”‚
â”‚  â”‚    â”‚ Return: MeterEntity[] from REMOTE database                 â”‚  â”‚   â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                    â”‚                                  â”‚   â”‚
â”‚  â”‚                                    â–¼                                  â”‚   â”‚
â”‚  â”‚ âœ“ Get local meters from LOCAL database                              â”‚   â”‚
â”‚  â”‚ âœ“ Compare remote vs local                                           â”‚   â”‚
â”‚  â”‚ âœ“ INSERT new meters into LOCAL database                             â”‚   â”‚
â”‚  â”‚ âœ“ UPDATE changed meters in LOCAL database                           â”‚   â”‚
â”‚  â”‚ âœ“ DELETE/DEACTIVATE removed meters in LOCAL database                â”‚   â”‚
â”‚  â”‚ âœ“ Log sync operation to sync_log table                              â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Return: MeterSyncResult {                                           â”‚   â”‚
â”‚  â”‚   success: true,                                                    â”‚   â”‚
â”‚  â”‚   inserted: 5,                                                      â”‚   â”‚
â”‚  â”‚   updated: 2,                                                       â”‚   â”‚
â”‚  â”‚   deleted: 1,                                                       â”‚   â”‚
â”‚  â”‚   timestamp: Date                                                   â”‚   â”‚
â”‚  â”‚ }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Response
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SYNC FRONTEND (React)                                  â”‚
â”‚                                                                              â”‚
â”‚ MeterSyncCard receives response and updates UI:                             â”‚
â”‚ - Shows "Meter sync triggered successfully"                                 â”‚
â”‚ - Updates last sync timestamp                                               â”‚
â”‚ - Shows inserted/updated/deleted counts                                     â”‚
â”‚ - Refreshes meter count                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Connections

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYNC MCP SERVER                                       â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Connection Pools (connection-pools.ts)                             â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ remotePool â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ (Client System Database)                                         â”‚ â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚ â”‚
â”‚  â”‚ syncPool â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ (Sync System Database)                                          â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MeterSyncAgent                                                     â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ getRemoteMeters() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â”‚ Uses: this.remotePool.query()                                  â”‚ â”‚ â”‚
â”‚  â”‚ Queries: REMOTE database                                       â”‚ â”‚ â”‚
â”‚  â”‚ Returns: Meters from Client System                             â”‚ â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â”‚ performSync() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â”‚ Uses: this.syncDatabase (which uses syncPool)                  â”‚ â”‚ â”‚
â”‚  â”‚ Queries: LOCAL database                                        â”‚ â”‚ â”‚
â”‚  â”‚ Updates: LOCAL database with synced meters                     â”‚ â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  REMOTE DATABASE        â”‚     â”‚  LOCAL DATABASE         â”‚
        â”‚  (Client System)        â”‚     â”‚  (Sync System)          â”‚
        â”‚                         â”‚     â”‚                         â”‚
        â”‚ Tables:                 â”‚     â”‚ Tables:                 â”‚
        â”‚ - meter                 â”‚     â”‚ - meter                 â”‚
        â”‚ - meter_element         â”‚     â”‚ - meter_reading         â”‚
        â”‚ - tenant                â”‚     â”‚ - sync_log              â”‚
        â”‚ - user                  â”‚     â”‚ - tenant                â”‚
        â”‚ - etc.                  â”‚     â”‚ - etc.                  â”‚
        â”‚                         â”‚     â”‚                         â”‚
        â”‚ READ ONLY               â”‚     â”‚ READ/WRITE              â”‚
        â”‚ (by meter sync)         â”‚     â”‚ (by meter sync)         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Debugger Breakpoint Sequence

```
User clicks "Trigger Meter Sync"
        â”‚
        â–¼
ğŸ”´ DEBUGGER #1 (API Endpoint)
   sync/mcp/src/api/server.ts
   POST /api/local/meter-sync-trigger
   
   Inspect:
   - _req (HTTP request)
   - this.meterSyncAgent (agent instance)
   
   Press: Continue (F5)
        â”‚
        â–¼
ğŸ”´ DEBUGGER #2 (Main Sync Operation)
   sync/mcp/src/sync-service/meter-sync-agent.ts
   performSync()
   
   Inspect:
   - this.tenant_id (tenant being synced)
   - this.isSyncing (sync status)
   - this.status (current status)
   
   Press: Continue (F5)
        â”‚
        â–¼
ğŸ”´ DEBUGGER #3 (Remote Database Query)
   sync/mcp/src/sync-service/meter-sync-agent.ts
   getRemoteMeters(tenantId)
   
   Inspect:
   - tenantId (tenant ID)
   - query (SQL being executed)
   - result.rows (meters from REMOTE database)
   
   Press: Continue (F5)
        â”‚
        â–¼
Sync completes and returns to frontend
```

---

## Key Variables to Inspect

### At Debugger #1
```javascript
_req.body          // Request body (empty for this endpoint)
this.meterSyncAgent // MeterSyncAgent instance
this.database      // SyncDatabase instance
```

### At Debugger #2
```javascript
this.tenant_id     // e.g., 1
this.isSyncing     // false (should be false at start)
this.status        // { isRunning, isSyncing, lastInsertedCount, ... }
remoteMeters       // Array of meters from REMOTE database
localMeters        // Array of meters from LOCAL database
```

### At Debugger #3
```javascript
tenantId           // e.g., 1
query              // SQL query string
result.rows        // Array of meter objects from REMOTE database
result.rows[0]     // First meter object (inspect structure)
```

---

## Summary

âœ… **Debugger #1** - Entry point when trigger button is clicked  
âœ… **Debugger #2** - Main sync operation starts  
âœ… **Debugger #3** - Remote database query executes  

All three debuggers are compiled and ready to use. Just start the debugger and click the button!
